import{w as $,u as R,a as T,R as j,j as e,L as B}from"./chunk-UIGDSWPH-BXv6hRbg.js";const u="serenote_journals";function O(S){try{const l=localStorage.getItem(u);return l&&JSON.parse(l).find(i=>String(i.id)===String(S))||null}catch{return null}}function L(S,l,{title:f,content:i}){try{const m=localStorage.getItem(u),x=m?JSON.parse(m):[],N=x.find(r=>String(r.id)===String(S));if(!N)return null;const a=N.pages.find(r=>String(r.id)===String(l));return a?(typeof f<"u"&&(a.title=f),typeof i<"u"&&(a.content=i),localStorage.setItem(u,JSON.stringify(x)),{...a}):null}catch{return null}}const _=$(function(){const{journalId:l}=R(),f=T?.()||{},{journals:i,addPage:m,updatePage:x,deletePage:N}=f,[a,r]=j.useState(null),[d,g]=j.useState(0),[I,y]=j.useState(""),[w,b]=j.useState("");j.useEffect(()=>{if(Array.isArray(i)){const t=i.find(n=>String(n.id)===String(l))||null;r(t),g(0)}else{const t=O(l);r(t),g(0)}},[i,l]),j.useEffect(()=>{if(!a){y(""),b("");return}const t=a.pages?.[d]??null;y(t?.content??""),b(t?.title??"")},[a,d]);const C=(t="",n="")=>{if(a){if(typeof m=="function"){m(a.id,{content:t,title:n});return}try{const p=localStorage.getItem(u),s=p?JSON.parse(p):[],c=s.findIndex(E=>String(E.id)===String(a.id));if(c===-1)return;const h=s[c],D={id:h.pages.length?h.pages[h.pages.length-1].id+1:1,title:n,content:t,createdAt:Date.now()};h.pages.push(D),localStorage.setItem(u,JSON.stringify(s)),r({...h}),g(h.pages.length-1)}catch{}}},J=()=>{const t=a?.pages?.[d];if(!t)return;const n={title:w,content:I};if(typeof x=="function"){try{x(a.id,t.id,n)}catch{}return}if(L(a.id,t.id,n)){const s=O(a.id);r(s)}},k=()=>{const t=a?.pages?.[d];if(t){if(typeof N=="function"){N(a.id,t.id),g(n=>Math.max(0,n-1));return}try{const n=localStorage.getItem(u),p=n?JSON.parse(n):[],s=p.find(c=>String(c.id)===String(a.id));if(!s)return;s.pages=s.pages.filter(c=>String(c.id)!==String(t.id)),localStorage.setItem(u,JSON.stringify(p)),r({...s}),g(c=>Math.max(0,c-1))}catch{}}};if(!a)return e.jsxs("main",{className:"journal-missing",children:[e.jsx("h2",{children:"Journal not found"}),e.jsx("p",{children:"This journal doesn't exist or may have been removed."}),e.jsx("p",{children:e.jsx(B,{to:"/journals",children:"Back to journals"})})]});const o=a.pages??[],P=o.length?d+1:0,v=o.length,A=v===0?"No pages yet":o[d]?.title||`Page ${P}`;return e.jsxs("main",{className:"journal-page",children:[e.jsxs("div",{className:"journal-topbar",children:[e.jsxs("div",{className:"journal-title-wrap",children:[e.jsx("h1",{className:"journal-title",children:a.journalName}),e.jsx("div",{className:"journal-subheading-wrap",children:v===0?e.jsx("div",{className:"journal-subheading",children:A}):e.jsx("input",{className:"page-title-input",value:w,onChange:t=>b(t.target.value),placeholder:`Page ${P} title`,"aria-label":"Page title",onBlur:J})})]}),e.jsxs("div",{className:"journal-actions",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>C("",""),children:"+ New Page"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:J,disabled:!o.length,children:"Save"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:k,disabled:!o.length,children:"Delete Page"})]})]}),e.jsxs("div",{className:"journal-body",children:[e.jsxs("aside",{className:"page-list","aria-label":"Pages",children:[e.jsx("h4",{children:"Pages"}),e.jsxs("ul",{children:[o.length===0&&e.jsx("li",{className:"empty-note",children:"No pages yet"}),o.map((t,n)=>e.jsx("li",{children:e.jsx("button",{type:"button",className:n===d?"page-item active":"page-item",onClick:()=>g(n),children:t.title?t.title:`Page ${t.id}`})},t.id))]})]}),e.jsx("section",{className:"page-canvas","aria-label":"Page editor",children:o.length===0?e.jsx("div",{className:"empty-page",children:e.jsx("p",{children:"No pages. Use “New Page” to create one."})}):e.jsxs("div",{className:"page-editor-wrapper",children:[e.jsx("textarea",{className:"page-editor",value:I,onChange:t=>y(t.target.value),placeholder:"Write here..."}),e.jsx("div",{className:"page-counter","aria-hidden":!0,children:`${P} / ${v}`})]})})]})]})});export{_ as default};
